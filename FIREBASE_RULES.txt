// REGLAS DE SEGURIDAD DE FIREBASE FIRESTORE
// Copia y pega estas reglas en Firebase Console → Firestore Database → Rules

rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Cada usuario solo puede acceder a sus propios datos
    // La ruta users/{userId} verifica que el userId coincida con el auth.uid
    match /users/{userId}/{document=**} {
      // Permitir lectura y escritura solo si:
      // 1. El usuario está autenticado (request.auth != null)
      // 2. El UID del usuario autenticado coincide con el userId de la ruta
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Opcional: Si quieres permitir que los usuarios vean una lista de otros usuarios
    // (por ejemplo, para funciones sociales futuras), añade:
    // match /users/{userId} {
    //   allow read: if request.auth != null;
    //   allow write: if request.auth != null && request.auth.uid == userId;
    // }
  }
}

/* 
EXPLICACIÓN DE LAS REGLAS:

1. users/{userId}/**
   - El ** significa "todos los documentos y subcolecciones dentro de esta ruta"
   - Esto incluye tanto /users/{userId}/entries como /users/{userId}/settings

2. request.auth != null
   - Verifica que el usuario esté autenticado
   - Si no está logueado, no puede acceder a nada

3. request.auth.uid == userId
   - Verifica que el UID del usuario autenticado coincida con el userId de la ruta
   - Esto garantiza que cada usuario solo acceda a sus propios datos

EJEMPLO:
- Usuario A (UID: abc123) intenta leer users/abc123/entries ✅ PERMITIDO
- Usuario A (UID: abc123) intenta leer users/xyz789/entries ❌ DENEGADO
- Usuario sin login intenta leer cualquier cosa ❌ DENEGADO

CÓMO APLICAR:
1. Ve a https://console.firebase.google.com
2. Selecciona tu proyecto "breadcrumbs-8b59e"
3. Ve a "Firestore Database" en el menú lateral
4. Haz clic en la pestaña "Rules"
5. Reemplaza el contenido con estas reglas
6. Haz clic en "Publicar"

⚠️ IMPORTANTE: Sin estas reglas, cualquier usuario podría ver los datos de otros usuarios!
*/
